@{
    ViewData["Title"] = "Alarm Details";
}

<div class="container-fluid py-1" style="max-width: 1700px;">
    <div class="row mt-4">
        <div class="col-12 mb-2">
            <h1 class="h2 fw-bold">Machine's Alarm Details</h1>
        </div>
        <div class="col-md-6 mb-2">
            @Html.Partial("_AlarmInformations", ViewData["Alarm"])
        </div>
        <div class="col-md-6 mb-2">
            @Html.Partial("_Notes", ViewData["Notes"])
        </div>
        <div class="col-md-6 mb-2">
            @Html.Partial("_MachineInformations", ViewData["Alarm"])
        </div>
    </div>
</div>
<script>
    function updateAlarmStatus(alarmId, status) {
        const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value;
        if (!token) {
            alert('CSRF token is missing.');
            return;
        }
        fetch(`/AlarmDetail/UpdateStatus`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': token
            },
            body: JSON.stringify({id: alarmId, status: status})
        }).then(response => {
            if (!response.ok) {
                alert('Error updating status.');
            }
        }).catch(error => {
            alert('Network error updating status.');
        });
    }

    async function updateAlarmAttribution(alarmId, userId) {
        const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value;

        if (!token) {
            alert('CSRF token is missing.');
            return;
        }

        if (!alarmId || !userId) {
            alert('Invalid alarm or user ID.');
            return;
        }
        try {
            const response = await fetch('/AlarmDetail/Attribution', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': token
                },
                body: JSON.stringify({
                    id: alarmId,
                    userId: userId
                })
            });
            if (response.ok) {
                const result = await response.json();
            } else {
                alert('Error: Failed to update attribution. Status code: ' + response.status);
            }
        } catch (error) {
            console.error('Network or server error:', error);
            alert('An error occurred while updating the attribution.');
        }
    }
</script>
