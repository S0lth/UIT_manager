@using UITManagerWebServer.Helpers
@model List<UITManagerWebServer.Models.ModelsView.AlarmViewModel>

@{
    string pageTitle = "Alarm"; 

    if (Context.Request.Query["tab"] == "unprocessed")
    {
        pageTitle = "Unprocessed Alarm";
    }
    else if (Context.Request.Query["tab"] == "newest")
    {
        pageTitle = "Newest Alarm";
    }
    else if (Context.Request.Query["tab"] == "overdue")
    {
        pageTitle = "Alarm Exceeding Estimated Processing Time";
    }
}

<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">
            @pageTitle
            <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#alarmModal">
                <i class="bi bi-info-circle"></i>
            </button>
            @if (Model.Count > 0)
            {
                <span class="badge bg-primary">@Model.Count</span>
            }
        </h5>

        @if (!Model.Any())
        {
            <div class="alert alert-secondary text-center" role="alert">
                No @pageTitle.
            </div>
        }
        else
        {
            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                <table class="table table-hover table-striped table-bordered rounded">
                    <thead class="table-light sticky-top">
                    <tr>
                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "machine")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["MachineSortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Host <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "machine")"></i>
                            </a>
                        </th>

                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "model")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["ModelSortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Model <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "model")"></i>
                            </a>
                        </th>

                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "status")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["StatusSortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Status <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "status")"></i>
                            </a>
                        </th>

                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "severity")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["SeveritySortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Severity <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "severity")"></i>
                            </a>
                        </th>

                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "alarmgroup")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["AlarmGroupSortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Alarm <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "alarmgroup")"></i>
                            </a>
                        </th>

                        <th class="text-nowrap @ViewHelpers.GetHeaderClass(ViewData["SortOrder"]?.ToString(), "date")">
                            <a asp-action="Index"
                               asp-route-tab="@Context.Request.Query["tab"]"
                               asp-route-sortOrder="@ViewData["DateSortParam"]?.ToString()"
                               asp-route-solutionFilter="@Context.Request.Query["SolutionFilter"]"
                               asp-route-authorFilter="@Context.Request.Query["AuthorFilter"]"
                               asp-route-sortOrderNote="@Context.Request.Query["SortOrderNote"]"
                               class="text-decoration-none text-dark">
                                Date <i class="bi @ViewHelpers.GetSortIcon(ViewData["SortOrder"]?.ToString(), "date")"></i>
                            </a>
                        </th>
                    </tr>

                    </thead>
                    <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <a asp-controller="Machine" asp-action="Details"
                                   asp-route-id="@item.MachineId"
                                   class="text-primary text-decoration-none">
                                    @item.MachineName
                                </a>
                            </td>
                            <td>@item.ModelName</td>
                            <td>@item.Status</td>
                            <td>@item.Severity</td>
                            <td>
                                <a asp-controller="AlarmDetail" asp-action="Index"
                                   asp-route-id="@item.AlarmId"
                                   class="text-primary text-decoration-none">
                                    @item.AlarmGroupName
                                </a>
                            </td>
                            <td>@item.TriggeredAt.ToString("dd-MM-yyyy HH:mm")</td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
