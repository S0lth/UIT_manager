@model Dictionary<string, Dictionary<string, double>>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">
            Alarm Distribution by site and severity
            <button type="button" class="btn btn-link" data-bs-toggle="modal"
                    data-bs-target="#AlarmCountsBySiteAndSeverityModal">
                <i class="bi bi-info-circle"></i>
            </button>
        </h5>
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th scope="col">
                    <a href="@Url.Action("Index", "Alarms", new { search = "All" })">Site</a>
                </th>
                @if (Model != null && Model.Count > 0)
                {
                    var severityList = Model.Values
                        .SelectMany(d => d.Keys)
                        .Distinct()
                        .ToList();

                    foreach (var severity in severityList)
                    {
                        <th scope="col">
                            <a href="@Url.Action("Index", "Alarms", new { severity = severity })">@severity</a>
                        </th>
                    }
                }
            </tr>
            </thead>
            <tbody>
            @if (Model != null && Model.Count > 0)
            {
                var sortedSiteEntries = Model.OrderBy(site => site.Key).ToList();
                var severityList = Model.Values
                    .SelectMany(d => d.Keys)
                    .Distinct()
                    .ToList();

                foreach (var siteEntry in sortedSiteEntries)
                {
                    <tr>
                        <td>
                            <a href="@Url.Action("Index", "Alarms", new { search = siteEntry.Key + "-" })">@siteEntry.Key</a>
                        </td>
                        @foreach (var severity in severityList)
                        {
                            <td>
                                @if (!siteEntry.Value.ContainsKey(severity))
                                {
                                    <span>/</span>
                                }
                                else
                                {
                                    @string.Format("{0:0.00} %", siteEntry.Value[severity])
                                }
                            </td>
                        }
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="6">No data available</td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>
